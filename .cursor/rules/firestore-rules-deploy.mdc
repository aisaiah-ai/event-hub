---
description: How to deploy Firestore rules — must target each database explicitly
globs: firestore.rules,firebase.json,docs/**/FIRESTORE*.md
alwaysApply: true
---

# Deploying Firestore Rules

## Correct deploy (fixed)

`firebase deploy --only firestore:rules` does NOT reliably deploy to all databases when multiple exist. **Target each database explicitly:**

```bash
firebase deploy --only 'firestore:(default)'
firebase deploy --only 'firestore:event-hub-dev'
# for prod: firebase deploy --only 'firestore:event-hub-prod'
```

## Scripts

- **Dev:** `./scripts/deploy-firestore-dev.sh` — deploys to (default) and event-hub-dev
- **Prod:** `./scripts/deploy-firestore-prod.sh` — deploys to all prod databases
- **event-hub-dev only:** `./scripts/deploy-firestore-rules-event-hub-dev.sh`

## Fallback (if deploy fails: auth, network)

Run `./scripts/print-firestore-rules-for-paste.sh` and paste manually in Firebase Console → Firestore → select database → Rules tab.
